<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />

    <!-- Allows the app to request exemption from battery optimizations -->
    <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" />

    <!-- General permission for foreground services -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE"
        tools:ignore="ForegroundServicesPolicy" />
    <!-- Specific permission type for Android 14+ -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />

    <!-- Runtime permission required for Android 13+ to show notifications -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

    <!--
      This block is required for apps targeting Android 11 (API 30) or higher.
      It declares that this app needs to query the package information for
      'com.alpha.lockapp' in order to launch it. Without this, the PackageManager
      will not return the launch intent, even if the app is installed.
    -->
    <queries>
        <package android:name="com.alpha.lockapp" />
    </queries>

    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.YKKAPSmartLockAssistant"
        tools:targetApi="31">

        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:theme="@style/Theme.YKKAPSmartLockAssistant">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <!-- Activity to wake device and dismiss non-secure lock screen -->
        <activity
            android:name=".UnlockAndLaunchActivity"
            android:exported="false"
            android:taskAffinity=""
            android:excludeFromRecents="true" />

        <service
            android:name=".service.LockBridgeService"
            android:exported="false"
            android:foregroundServiceType="dataSync" />

        <service
            android:name=".service.YkkAccessibilityService"
            android:exported="false"
            android:label="@string/accessibility_service_label"
            android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
            tools:ignore="AccessibilityPolicy">
            <intent-filter>
                <action android:name="android.accessibilityservice.AccessibilityService" />
            </intent-filter>
            <meta-data
                android:name="android.accessibilityservice"
                android:resource="@xml/accessibility_service_config" />
        </service>

    </application>
</manifest>
